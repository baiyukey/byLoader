$(function(){$.fn.extend({byAlert:function(A){A=$.extend({fadeTime:300,mark:true,markOpacity:0.15,markColor:"#FFF",callBack:false,callBackArr:null,closeBtn:true,animate:100},A);var l,w;l=$(window.top);w=$(window.top.document);var p=$(this);if(p.length===0){alert("对象未找到");return false}var k=0;var f=(Math.random()*1000).toFixed(0);var b=p.outerWidth();var z=p.outerHeight();var s=p.height();var y=p.css("display");if(z>w.height()){s=w.height()-(z-s);z=w.height()}var e="bodyMark_"+f;var a="disableMark_"+f;var x="showPanel_"+f;var d="recordPlace_"+f;var u="closeBtn_"+f;var n='<div id="'+e+'" class="bodyMark" style="position:absolute; width:'+w.width()+"px; height:"+w.height()+"px; z-index:888888; left:0; top:0; background:"+A.markColor+"; display:none;_position:absolute;_height:"+w.outerHeight()+';"></div>';var g='<div id="'+x+'" data-fadetime="'+A.fadeTime+'" data-hisdisplay="'+y+'" class="showPanel" style="display:none; width:'+b+"px; height:"+z+'px; position:absolute;_position:absolute; left:0; top:0;"><a href="#" id="'+u+'" class="byAlertClose" title="关闭" style="position:absolute; right:0; top:0; display:block; z-index:1;"></a><div class="byAlertCont" style="position:absolute;padding:0;"></div></div><div id="'+a+'" class="disableMark" style="position:absolute; display:none; width:'+w.width()+"px; height:"+w.height()+"px; z-index:999999; left:0; top:0; background:#ffffff;_position:absolute;_height:"+w.outerHeight()+';"></div>';w.find("body").append(n+g);p.before('<div id="'+d+'" style="display:none;"></div>');var c=w.find("#"+e);var o=w.find("#"+x);var j=w.find("#"+a);var h=p.closest("body").find("#"+d);var q=function(){var C=(w.width()-b)*0.5;var B=0;if((w.scrollTop()+z)>w.height()){B=w.height()-z}else{B=w.scrollTop()+((l.height()-z)*0.4);B<w.scrollTop()?B=w.scrollTop():null}B<0?B=0:null;this.alertX=C;this.alertY=B};var r=function(){w.find(".showPanel").css({"z-index":999996});$(this).closest(".showPanel").css({"z-index":999997})};var t=function(){j.hide();p.find("div.alertTit").length>0?k=p.find(".alertTit").outerHeight():null;if(o.find("div.alertCont").length>0){var B=o.find("div.alertCont");B.css({height:(s-parseInt(B.css("padding-top"))-parseInt(B.css("padding-bottom"))-k),"overflow-y":"auto"})}i();A.callBack&&typeof(A.callBack)==="function"?A.callBack.call(this,A.callBackArr):null;o.find("input[type='text']:visible").length>0?o.find("input[type='text']:visible:eq(0)").focus():o.find("textarea:eq(0)").focus()};var i=function(){w.find(".bodyMark").css({width:l.width(),height:w.height()});w.find(".disableMark").css({width:l.width(),height:w.height()});l[0].oldOnresize?l[0].oldOnresize.call(this):null};var m=function(){p.show().insertBefore(o.find("div.byAlertCont"));var B=new q();j.css({opacity:"0.01",display:"block"});o.css({left:B.alertX,top:(B.alertY-A.animate),"z-index":999998,opacity:"0.1",display:"block"}).stop(true,false).animate({top:(B.alertY),opacity:"1"},A.fadeTime);setTimeout(t,A.fadeTime)};var v=function(C){C.preventDefault();var B=function(){if($(("#"+d)).length===0){$(w[0].getElementsByTagName("iframe")[0].contentWindow.document).find("#"+d).after(o.find(p).css({display:y}))}else{$("#"+d).after(o.find(p).css({display:y}))}h.after(o.find(p).css({display:y}));h.remove();o.remove();j.remove();if(w.find(".bodyMark.wantShow").length>1){c.siblings(".bodyMark.wantShow:eq(0)").show();c.stop(true,false).remove()}else{if(w.find(".bodyMark.wantShow").length===1){c.stop(true,false);if(c.hasClass("wantShow")){c.fadeOut(A.fadeTime,function(){c.remove()})}else{c.stop(true,false).remove()}}else{c.stop(true,false).remove()}}};j.show();o.off("click","#"+u);o.stop(true,false).animate({top:(o.offset().top-A.animate),opacity:0},A.fadeTime).fadeOut(0,B)};if(A.closeBtn===false){w.find("#"+u).hide()}if(A.mark){c.addClass("wantShow").css("opacity",A.markOpacity);if(w.find(".bodyMark.wantShow").length===1){w.find(".bodyMark.wantShow").eq(0).fadeIn(300,m)}else{if(w.find(".bodyMark.wantShow").length>1){w.find(".bodyMark.wantShow").eq(0).fadeIn(0,m).siblings(".bodyMark.wantShow").hide()}else{m()}}}else{m()}o.on("click","#"+u,v);o.on("click","a.cancel",v);o.find(".alertTit").off("mousedown");o.on("mousedown",".alertTit",function(D){var H,F,B,K,J,C,I,G;H=o.offset().left;F=o.offset().top;B=D.pageX;K=D.pageY;J=o.closest("body").width();C=o.closest("body").height();var E=function(L){I=L.pageX-B+H;G=L.pageY-K+F;if(I<=0){return false}if(I>=(J-o.width())){return false}if(G<=0){return false}if(G>=(C-o.height())){return false}o.css({left:I,top:G})};o.css({cursor:"move"});o.closest("body").css({"-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","-khtml-user-select":"none","user-select":"none"});w.off("mousemove").on("mousemove",o,E);w.off("mouseup").on("mouseup",o.find(".alertTit:eq(0)"),function(){w.off("mousemove");o.css({cursor:""});o.closest("body").css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","-khtml-user-select":"","user-select":""})})});o.on("mousedown",this,r);return p},byAlertExit:function(f){var c=$(this);var b=c.closest(".showPanel").attr("id");var a=$("#"+b).css("opacity");var e=$(window.top.document);f=$.extend({fadeTime:parseInt(e.find("#"+b).attr("data-fadetime")),callBack:false,callBackArr:null,animate:100},f);var d=function(){if(e.find("#"+b).length===1&&e.find("#"+b).css("opacity")===a){var g=b.replace("showPanel","");var j=e.find("#"+b).attr("data-hisdisplay");var i=$("#recordPlace"+g);var h=function(){if(i.length===0){$(e[0].getElementsByTagName("iframe")[0].contentWindow.document).find("#recordPlace"+g).after($("#showPanel"+g).find(c).css({display:j}));$(e[0].getElementsByTagName("iframe")[0].contentWindow.document).find("#recordPlace"+g).remove()}else{i.after($("#showPanel"+g).find(c).css({display:j}));i.remove()}e.find("#disableMark"+g).remove();e.find("#showPanel"+g).remove();if(e.find(".bodyMark.wantShow").length>1){e.find("#bodyMark"+g).siblings(".bodyMark.wantShow:eq(0)").show();e.find("#bodyMark"+g).stop(true,false).remove()}else{if(e.find(".bodyMark.wantShow").length===1){if(e.find("#bodyMark"+g).hasClass("wantShow")){e.find("#bodyMark"+g).stop(true,false);e.find("#bodyMark"+g).fadeOut(f.fadeTime,function(){e.find("#bodyMark"+g).remove()})}else{e.find("#bodyMark"+g).stop(true,false).remove()}}else{e.find("#bodyMark"+g).stop(true,false).remove()}}f.callBack&&typeof(f.callBack)==="function"?f.callBack.call(this,f.callBackArr):null};e.find("#showPanel"+g).stop(true,false).animate({top:(e.find("#showPanel"+g).offset().top-f.animate),opacity:0},f.fadeTime).fadeOut(0,h)}else{f.callBack&&typeof(f.callBack)==="function"?f.callBack.call(this,f.callBackArr):null}};c.closest(".showPanel").find("a.byAlertClose").trigger("click");setTimeout(d,f.fadeTime);return $(this)}})});