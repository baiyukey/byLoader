/**
 * @link : https://github.com/baiyukey/headLoader
 * @version : 2.0.9
 * @copyright : http://www.uielf.com
 */
function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function a(o,s){try{var i=t[o](s),l=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(l).then(function(e){a("next",e)},function(e){a("throw",e)});e(l)}("next")})}}let headLoader,localDB;!function(e){let t=new Function;if(e.XMLHttpRequest)t=e.XMLHttpRequest;else{if(!e.ActiveXObject)return alert("浏览器不支持XMLHttpRequest，请使用现代浏览器，例如chrome等。");t=e.ActiveXObject("Microsoft.XMLHTTP")}let n=/^((192\.168|172\.([1][6-9]|[2]\d|3[01]))(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){2}|10(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){3})|(localhost)$/.test(e.location.hostname)?"":".min",a=function(e){let t=new Date,a=e||12;return a=Math.min(24,a),""===n?""+t.getTime():""+(t.getMonth()+1)+t.getDate()+Math.ceil((t.getHours()+1)/a)};localDB=function(t){let n={database:"headLoaderDB",tables:{data:["key","value","version"]},version:a};Object.assign(n,t),e.localDBResult=e.localDBResult||null,e.localDBStatus=e.localDBStatus||0;const o=function(){return void 0!==e.waitCloseLocalDB&&clearTimeout(e.waitCloseLocalDB),new Promise((t,a)=>{if(null!==e.localDBResult&&1===e.localDBStatus)return void t("success");let o=e.indexedDB.open(n.database);o.onerror=function(e){a(e)},o.onsuccess=function(n){e.localDBResult=o.result,e.localDBStatus=1,t(n)},o.onupgradeneeded=function(a){e.localDBResult=a.target.result,e.localDBStatus=1;let o=Object.keys(n.tables);for(const t of o)if(!e.localDBResult.objectStoreNames.contains(t)){let a=e.localDBResult.createObjectStore(t,{keyPath:"key"});n.tables[t].forEach(e=>a.createIndex(e,"key",{unique:!0}))}a.target.transaction.oncomplete=(()=>t(e.localDBResult))}})},s=function(t){return void 0!==e.waitCloseLocalDB&&clearTimeout(e.waitCloseLocalDB),new Promise((n,a)=>{e.waitCloseLocalDB=setTimeout(function(){0!==e.localDBStatus?(null!==e.localDBResult&&e.localDBResult.close(),e.localDBStatus=0,n("success")):n("success")},t||3e3)})},i=(l=_asyncToGenerator(function*(){if(!e.localDBResult)return console.warn(`目前还没有库${n.database}`);yield s(0),e.indexedDB.deleteDatabase(n.database),p&&console.log(`${n.database}已删除`)}),function(){return l.apply(this,arguments)});var l;const c=function(t,a,s){return new Promise((i=_asyncToGenerator(function*(i,l){yield o();let c=e.localDBResult.transaction(t,"readwrite").objectStore(t),r={key:a,value:s.value?s.value:s,etag:s.etag,version:n.version()};new Promise(function(e,t){let n=c.index("key").get(a);n.onsuccess=(t=>{e(t.target.result?"put":"add")}),n.onerror=(()=>e("add"))}).then(function(e){let t=c[e](r);t.onsuccess=function(){i("success")},t.onerror=function(e){l(e)}})}),function(e,t){return i.apply(this,arguments)}));var i},r=(u=_asyncToGenerator(function*(t,n){return yield o(),new Promise(function(a,o){let s=e.localDBResult.transaction(t,"readonly").objectStore(t).index("key").get(n);s.onsuccess=function(e){a(s.result)},s.onerror=function(e){o(e)}})}),function(e,t){return u.apply(this,arguments)});var u;(function(){return!!(e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.msIndexedDB)||(console&&console.log("您的浏览器不支持indexedDB，请使用现代浏览器，例如chrome,firefox等."),!1)})&&(this.open=o,this.close=s,this.delete=i,this.setItem=c,this.getItem=r)},headLoader=function(o){let s=o||{};this.dataDir=s.dataDir||"",this.dataCss=s.dataCss||[],this.dataJs=s.dataJs||[],this.dataFont=s.dataFont||[],this.dataHtml=s.dataHtml||[],this.dataLifecycle=s.dataLifecycle||h,this.dataActive=s.dataActive||d,this.callback=s.callback||null,this.multiLoad=s.multiLoad||".min"===n,this.showLog=s.showLog||!1,this.preload=void 0!==s.preload?s.preload:0;let i=this,l=function(e){let t=[],n="";for(let a=0;a<e.length;a++)0!==(n=e[a].replace(/^(\s*)|(\s*)$/g,"")).length&&t.indexOf(n)<0&&t.push(n);return t},c=function(e,t){t.length>0&&t.forEach(function(t){e.setAttribute(t.split("=")[0],t.split("=")[1])})};void 0===e.headLoaderCache&&(e.headLoaderCache={});let r=function(e,t){i.db.setItem("data",L.encode(e),t).then(null)},u=function(e,t,a){return i.dataActive&&["js","css"].includes(t)?`${i.dataDir}${t}${n}/${e.split("|")[0]}`.replace("."+(a||t),"")+n+"."+(a||t):`${i.dataDir}${e.split("|")[0]}.${a||t}`},p=function(e,n){return new Promise((o,s)=>{if(!e)return o(2);e.version!==i.cacheVersion?""===e.etag?o(2):(a=n,new Promise((e,n)=>{let o=new t;o.open("HEAD",a,!0),o.send(),o.onreadystatechange=function(){4===Number(o.readyState)&&200===Number(o.status)&&e(o.getResponseHeader("etag")||o.getResponseHeader("last-modified")||"")},o.onerror=(e=>n(e))})).then(t=>{e.etag===t?o(1):o(2)}).catch(e=>s(e)):o(0)});var a},y=function(e,a){return new Promise(o=>{if((e=>0===e.indexOf("http://")||0===e.indexOf("https://"))(e))return"js"===a?b(e):"css"===a&&w(e),o("success");let s,l=u(e,a)+"?v="+i.cacheVersion,c=function(e,t){return["js","css"].includes(t)?(i.dataDir+t+n+"/"+e.split("|")[0]).replace("."+t,"")+n:(i.dataDir+e.split("|")[0]).replace("."+t,"")}(e,a);i.db.getItem("data",L.encode(c)).then(e=>{p(s=e,l).then(e=>(function(e){if(0===e)o("success");else if(1===e)r(c,s),o("success");else if(2===e){let e=new t;e.open("GET",l,!0),e.send(),e.onreadystatechange=function(){if(4===Number(e.readyState)&&200===Number(e.status)){let t=e.responseText||"";"css"===a&&(t=t.replace(/\[v]/g,i.cacheVersion)),r(c,{value:t,etag:e.getResponseHeader("etag")||e.getResponseHeader("last-modified")||""}),i.showLog&&f++,o("success")}}}})(e)).catch(e=>console.error(e))})})},J=function(e){return new Promise((t=_asyncToGenerator(function*(t){let n=u(e,"fonts","woff")+"?v="+i.cacheVersion;if("function"!=typeof FontFace)return new Promise(function(e){return e("success")});const a=new FontFace("elfRound","url("+n+")");yield a.load(),document.fonts.add(a),t("success")}),function(e){return t.apply(this,arguments)}));var t},U=function(e,t){if(""!==n)return Function(t)(),!1;let a=document.getElementsByTagName("HEAD").item(0),o=document.createElement("script");c(o,e.split("|").splice(1)),o.setAttribute("type","text/javascript"),o.setAttribute("data-name",e.split("|")[0].replace(".js","")+n),o.innerHTML=t,a.appendChild(o)},T=function(e,t){if(0===document.getElementsByTagName("HEAD").length)return!1;let a,o=document.getElementsByTagName("HEAD").item(0);if(i.multiLoad&&(a=document.getElementsByTagName("style").item(0)))return a.innerHTML+=t,!1;a=document.createElement("style"),c(a,e.split("|").splice(1)),a.setAttribute("type","text/css"),a.setAttribute("data-name",e.split("|")[0].replace(".css","")+n),a.innerHTML=t,o.appendChild(a)},b=function(e){if(0===document.getElementsByTagName("HEAD").length)return!1;let t=document.getElementsByTagName("HEAD").item(0),a=document.createElement("script");c(a,e.split("|").splice(1)),a.src=0===e.indexOf("http")?e.split("|")[0]:e.split("|")[0].replace(".js","")+n+".js?v="+i.cacheVersion,t.appendChild(a)},w=function(e){if(0===document.getElementsByTagName("HEAD").length)return!1;let t=document.getElementsByTagName("HEAD").item(0),a=document.createElement("link");c(a,e.split("|").splice(1)),a.type="text/css",a.rel="stylesheet",a.media="screen",a.href=0===e.indexOf("http")?e.split("|")[0]:e.split("|")[0].replace(".css","")+n+".css?v="+i.cacheVersion,t.appendChild(a)},D=(B=_asyncToGenerator(function*(e,t){return new Promise(function(a){let o,s={JS:U,CSS:T}[t.toUpperCase()];if(!s)return a("页面写入仅支持js、css.");let l={},c=[];e.forEach(function(e){l[e]=null;c.push(new Promise(function(a){o=i.dataDir+t+n+"/"+e.replace(/(\.js)|(\.css)/g,"")+n,i.db.getItem("data",L.encode(o)).then(t=>{l[e]=t.value,a(!0)})}))}),Promise.all(c).then(function(){s(1===e.length?e[0]:t+"_"+i.cacheVersion,Object.values(l).join("js"===t?";":" ")),a("success")})})}),function(e,t){return B.apply(this,arguments)});var B;let v=function(e,t){if(0===document.getElementsByTagName("HEAD").length)return!1;if(!e||0===e.length)return new Promise(e=>e("success"));let n={JS:y,CSS:y,FONT:J,HTML:y}[t.toUpperCase()],a=(o=_asyncToGenerator(function*(a){let o=0,s=(l=_asyncToGenerator(function*(){if(o>=e.length)return!0;yield n(e[o],t),0===i.preload&&(yield D([e[o]],t)),o++,yield s()}),function(){return l.apply(this,arguments)});var l;yield s(),a("success")}),function(e){return o.apply(this,arguments)});var o;return new Promise(i.multiLoad?function(a){e&&0!==e.length||a("success");let o=new Array(e.length).fill(0).map((a,o)=>new Promise((s=_asyncToGenerator(function*(a){yield n(e[o],t),a("success")}),function(e){return s.apply(this,arguments)})));var s;Promise.all(o).then(_asyncToGenerator(function*(){0!==e.length&&0===i.preload&&(yield D(e,t)),a("success")}))}:a)},L=new function(){let e="";for(let t=48;t<=122;t++)t>=58&&t<=64||t>=91&&t<=96||(e+=String.fromCharCode(t));let t=(e=(e=e.replace(/[aeiouAEIOU01]/g,"")).slice(0,18)+"$-_+!*"+e.slice(18)).length,n=location.host.length,a=-1,o="",s="";this.encode=function(i){o=encodeURIComponent(i).replace(/\./g,"&dot"),s="",a=-1;for(let i=0;i<o.length;i++)a=e.indexOf(o.charAt(i)),s+=a<0?o.charAt(i):e.charAt((a+n)%t);return s}};this.db=new localDB,this.run=function(){i.dataCss=l(i.dataCss.join(",").replace(/_css/g,g).split(",")),i.dataJs=l(i.dataJs.join(",").replace(/_js/g,g).split(",")),i.dataFont=l(i.dataFont),i.dataHtml=l(i.dataHtml),i.cacheVersion=a(h),_asyncToGenerator(function*(){yield i.db.open(),yield v(i.dataCss,"css"),yield v(i.dataFont,"font"),yield v(i.dataJs,"js"),yield v(i.dataHtml,"html"),i.showLog&&function(){let t=(new Date).getTime()-m;e.headLoaderHistory=void 0!==e.headLoaderHistory?e.headLoaderHistory:[],void 0!==e.showLogTimeout&&clearTimeout(e.showLogTimeout),e.showLogTimeout=setTimeout(()=>{f>0&&(e.headLoaderHistory=e.headLoaderHistory.concat(new Array(f-1).fill(0),t));let n=0,a=0;e.headLoaderHistory.length>0&&(n=e.headLoaderHistory.reduce((e,t)=>e+t),a=Math.ceil(n/e.headLoaderHistory.length)),console.log("当前页面使用headLoader"+(i.multiLoad?"并行":"串行")+"网络请求%c"+f+"个%cJS/CSS文件，程序用时%c"+t+"毫秒%c，累计网络请求%c"+e.headLoaderHistory.length+"个%cJS/CSS文件，单文件平均用时%c"+a+"毫秒","color:#1b8884","","color:#1b8884","","color:#1b8884","","color:#1b8884","")},3e3)}(),"function"==typeof i.callback&&i.callback.call(!1),yield i.db.close()})()}};let o,s,i=document.getElementsByTagName("script"),l=[],c=[],r=[],u=[],d=!1,h=12,f=1,m=(new Date).getTime();for(let e=0;e<i.length;e++)if(i[e].hasAttribute("src")&&i[e].getAttribute("src").indexOf(atob("aGVhZExvYWRlci4="))>=0){o=i.item(e);break}if(!o)return console.log&&console.log("%c"+decodeURIComponent(atob("JUU5JTk0JTk5JUU4JUFGJUFGJUU2JThGJTkwJUU3JUE0JUJBJTNBJUU3JUE4JThCJUU1JUJBJThGJUU2JTlDJUFBJUU2JTg4JTkwJUU1JThBJTlGJUU2JTg5JUE3JUU4JUExJThDJTJDJUU2JThGJTkyJUU0JUJCJUI2JUU1JTkwJThEJUU3JUE3JUIwJUU0JUI4JUJBaGVhZExvYWRlci5qcyVFNiU4OCU5NiVFOCU4MCU4NWhlYWRMb2FkZXIubWluLmpzJUU2JUIzJUE4JUU2JTg0JThGJUU1JUE0JUE3JUU1JUIwJThGJUU1JTg2JTk5LiVFNSVBNiU4MiVFNiU5QyU4OSVFNyU5NiU5MSVFOSU5NyVBRSVFOCVBRiVCNyVFOCVBRSVCRiVFOSU5NyVBRSUzQWh0dHBzJTNBJTJGJTJGZ2l0aHViLmNvbSUyRmJhaXl1a2V5JTJGaGVhZExvYWRlcg==")),"color:#F00"),!1;let p=console.log&&".min"!==n,g=location.pathname.replace(".html","");""===location.pathname.replace(/.*\//,"").replace(".html","")&&(g+="index"),g=0===g.indexOf("/")?g.substr(1):g,o.hasAttribute("data-active")?d=["true",""].includes(o.getAttribute("data-active")):p&&console.log('%c友情提示:script标签未设置"data-active"属性,默认为false.',"color:#69F;"),o.hasAttribute("data-lifecycle")?h=Number(o.getAttribute("data-lifecycle")):p&&console.log(`%c友情提示:script标签未设置"data-lifecycle"属性,默认为${h}小时.`,"color:#69F;"),o.hasAttribute("data-dir")?s=o.getAttribute("data-dir"):p&&console.log('%c友情提示:script标签未设置"data-dir"属性.',"color:#69F;"),o.hasAttribute("data-css")?c=o.getAttribute("data-css").split(","):p&&console.log('%c友情提示:script标签未设置"data-css"属性',"color:#69F;"),o.hasAttribute("data-js")?l=o.getAttribute("data-js").split(","):p&&console.log('%c友情提示:script标签未设置"data-js"属性',"color:#69F;"),o.hasAttribute("data-font")&&(r=o.getAttribute("data-font").split(",")),o.hasAttribute("data-html")?u=o.getAttribute("data-html").split(","):p&&console.log('%c友情提示:script标签未设置"data-js"属性',"color:#69F;"),i.length>0&&""!==n&&i.item(0).remove();let y=new headLoader;s&&(y.dataDir=s),y.dataCss=c,y.dataJs=l,y.dataFont=r,y.dataHtml=u,y.dataLifecycle=h,y.showLog=!1,y.run()}("null"===window.location.origin||window.location.origin===window.top.location.origin?window.top:window);
